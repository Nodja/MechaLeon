<!DOCTYPE html>
<html>

<head>
    <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify/dist/vuetify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/linkifyjs@2.1.6/dist/linkify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/linkifyjs@2.1.6/dist/linkify-element.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>


</head>

<body>
    <div id="app">
        <v-app dark>
            <v-content>

                <v-container grid-list-md>
                    <v-layout row wrap>
                        <v-flex xs10 offset-xs1 text-xs-center>
                            <h1> {{ page_title }} </h1>
                            <v-select :items="streams" item-text="name" item-value="rowid" label="Stream" v-model="selected_stream" @change="get_messages" solo></v-select>
                            <v-data-table :items="messages" hide-headers hide-actions>
                                <template slot="items" slot-scope="props">
                                    <td class="text-xs-right">{{ props.item.timestamp | timestamp }} </td>
                                    <td class="text-xs-right">{{ props.item.name }} </td>
                                    <td class="text-xs-left" v-linkified>{{ props.item.message }}</td>
                                </template>
                            </v-data-table>


                        </v-flex>
                    </v-layout>
                    <v-layout child-flex>

                    </v-layout>
                    <v-flex text-xs-center><br>@Nodja <a href="https://github.com/Nodja/joevotes"></a></v-flex>
                </v-container>
            </v-content>
        </v-app>


    </div>

    <script>

        new Vue({
            el: '#app',
            mounted() {
                document.title = this.page_title;
                axios
                    .get('/twitch-aggregator/streams/')
                    .then(response => {
                        this.streams = response.data;
                        this.selected_stream = this.streams[0];
                        this.get_messages(this.streams[0].rowid);
                    })
            },
            data: {
                page_title: "Stream fanart / link aggregator",
                streams: [],
                selected_stream: 0,
                messages: []
            }, methods: {
                get_messages(stream_id) {
                    axios
                        .get('/twitch-aggregator/messages/' + stream_id)
                        .then(response => (this.messages = response.data))
                }
            },
            filters: {
                timestamp: function (value) {
                    var m = moment(value);
                    return m.format("YYYY-MM-DD hh:mm:ss")
                }
            }
        })

        window.Vue.directive('linkified', function (el, binding) {
            linkifyElement(el, binding.value);
        });


    </script>
    <style>
        table.v-table tbody td,
        table.v-table tbody th {
            height: 25px;
            padding-right: 10px !important;
            padding-left: 0px !important;
        }
    </style>
</body>

</html>